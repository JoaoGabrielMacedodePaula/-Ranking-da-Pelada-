<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ranking da Pelada</title>
<style>
body { font-family: Arial, sans-serif; margin:10px; background:#f8f9fa; }
h2, h3 { text-align:center; margin-bottom:10px; }
table { width:100%; border-collapse: collapse; table-layout:auto; margin-top:10px; }
th, td { border:1px solid #dee2e6; padding:8px; text-align:center; font-size:14px; }
th { background-color:#343a40; color:white; }
tr:nth-child(even){ background:#e9ecef; }
form { margin-top:15px; padding:10px; background:#fff; border:1px solid #ccc; border-radius:6px; }
form label { display:block; margin:6px 0 3px; }
form textarea, form select, form button, form input { width:100%; padding:6px; margin-bottom:10px; box-sizing:border-box; }
button { background:#343a40; color:white; border:none; border-radius:4px; cursor:pointer; margin:2px; }
button:hover { background:#495057; }
#historico { margin-top:10px; }
.histItem { background:#fff; border:1px solid #ccc; border-radius:6px; padding:6px; margin-bottom:6px; display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; }
.histItem button { margin-left:2px; padding:2px 6px; font-size:12px; }
.botaoOrdenar { width:auto; padding:6px 10px; }
#atualizadoEm { font-size:14px; font-weight:bold; }
@media (max-width:500px){ table, th, td, button, input, select, textarea{ font-size:12px; } }
</style>
</head>
<body>

<h2>Ranking</h2>
<div style="text-align:center;">
<button class="botaoOrdenar" onclick="preencherTabela('saldo')">Saldo</button>
<button class="botaoOrdenar" onclick="preencherTabela('v')">Vit√≥rias</button>
<button class="botaoOrdenar" onclick="preencherTabela('d')">Derrotas</button>
<button class="botaoOrdenar" onclick="preencherTabela('pct')">%Vit√≥rias</button>
<button class="botaoOrdenar" onclick="preencherTabela('total')">Partidas</button>
</div>

<div style="display:flex; justify-content:space-between; align-items:center; margin-top:6px;">
  <div id="atualizadoEm">Atualizado em: 13/08/2025</div>
  <div>
    <button style="background:#dc3545;" onclick="resetarRanking()">Resetar ranking</button>
    <span style="color:#555; font-size:12px; margin-left:6px;">
      A tabela ser√° resetada para os dados do dia 13/08/2025.
    </span>
  </div>
</div>

<table id="rankingTable">
<thead>
<tr>
<th>Posi√ß√£o</th>
<th>Nome</th>
<th>Saldo</th>
<th>Vit√≥rias</th>
<th>Derrotas</th>
<th>%Vit√≥rias</th>
<th>Partidas</th>
</tr>
</thead>
<tbody id="rankingBody"></tbody>
</table>

<h2>Lan√ßamento das partidas</h2>
<form id="partidaForm">
<label for="dataJogo">Data da partida:</label>
<input type="date" id="dataJogo" required>

<label for="timeA">Jogadores do Time A (uma linha por jogador):</label>
<textarea id="timeA" rows="5" placeholder="Ex: Guerra&#10;Couto&#10;Lafet√°"></textarea>

<label for="timeB">Jogadores do Time B (uma linha por jogador):</label>
<textarea id="timeB" rows="5" placeholder="Ex: Jo√£ozin&#10;Furtado&#10;Nasci"></textarea>

<label for="vencedor">Time vencedor:</label>
<select id="vencedor">
<option value="A">Time A</option>
<option value="B">Time B</option>
</select>

<button type="submit">Registrar Partida</button>
</form>

<div id="historico">
<h3>Hist√≥rico de partidas</h3>
<div id="listaHistorico"></div>
</div>

<script>
const dadosIniciais = [
{nome:"Guerra",v:12,d:5},{nome:"Couto",v:9,d:4},{nome:"Lafet√°",v:8,d:3},{nome:"Jo√£ozin",v:6,d:1},{nome:"Furtado",v:3,d:0},
{nome:"Nasci",v:8,d:6},{nome:"Buscacio",v:3,d:1},{nome:"Jo√£o Gabriel",v:3,d:2},{nome:"BR",v:2,d:1},{nome:"Ximenes",v:8,d:8},
{nome:"Brand√£o",v:8,d:8},{nome:"Vitinho",v:6,d:6},{nome:"Tavares",v:3,d:3},{nome:"Andr√©",v:1,d:1},{nome:"Dudu",v:7,d:8},
{nome:"Alex",v:5,d:6},{nome:"Joaquim",v:4,d:5},{nome:"Saquetti",v:4,d:5},{nome:"Toledo",v:0,d:1},{nome:"Aur√©lio",v:0,d:1},
{nome:"Guiz√£o",v:0,d:2},{nome:"Dani",v:0,d:2},{nome:"Gaiotti",v:6,d:9},{nome:"Amaral",v:0,d:5},{nome:"Bechara",v:5,d:11},
{nome:"Pedro Arthur",v:2,d:8}
];
let jogadores = JSON.parse(localStorage.getItem("jogadoresPelada")) || dadosIniciais.slice();
let historico = JSON.parse(localStorage.getItem("historicoPelada")) || [];

function calcularDados(jog){
    const saldo = jog.v - jog.d;
    const total = jog.v + jog.d;
    const pct = total>0 ? (jog.v/total*100).toFixed(2) : "0.00";
    return {...jog,saldo,total,pct};
}

function preencherTabela(filtro='saldo'){
    const tbody = document.getElementById("rankingBody");
    tbody.innerHTML="";
    let dados = jogadores.map(calcularDados);

    switch(filtro){
        case "saldo":
            dados.sort((a,b)=> (b.saldo - a.saldo) || (b.v - a.v) || a.nome.localeCompare(b.nome));
            break;
        case "v":
            dados.sort((a,b)=> (b.v - a.v) || (b.pct - a.pct) || a.nome.localeCompare(b.nome));
            break;
        case "d":
            dados.sort((a,b)=> (a.d - b.d) || (b.total - a.total) || a.nome.localeCompare(b.nome));
            break;
        case "pct":
            dados.sort((a,b)=> (b.pct - a.pct) || (b.total - a.total) || a.nome.localeCompare(b.nome));
            break;
        case "total":
            dados.sort((a,b)=> (b.total - a.total) || (b.pct - a.pct) || a.nome.localeCompare(b.nome));
            break;
    }

    for(let i=0;i<dados.length;i++){
        const atual = dados[i];
        const saldoStr = atual.saldo>0 ? "+"+atual.saldo : atual.saldo;
        tbody.innerHTML += `<tr>
            <td>${i+1}¬∞</td>
            <td>${atual.nome}</td>
            <td>${saldoStr}</td>
            <td>${atual.v}</td>
            <td>${atual.d}</td>
            <td>${atual.pct}%</td>
            <td>${atual.total}</td>
        </tr>`;
    }
    localStorage.setItem("jogadoresPelada", JSON.stringify(jogadores));
    atualizarHistorico();
    atualizarUltimaData();
}

document.getElementById("partidaForm").addEventListener("submit", function(e){
    e.preventDefault();
    const data = document.getElementById("dataJogo").value;
    if(!data) { alert("Informe a data da partida!"); return; }

    const timeA = document.getElementById("timeA").value.split("\n").map(x=>x.trim()).filter(x=>x);
    const timeB = document.getElementById("timeB").value.split("\n").map(x=>x.trim()).filter(x=>x);
    const vencedor = document.getElementById("vencedor").value;
    historico.push({timeA,timeB,vencedor,data});
    localStorage.setItem("historicoPelada",JSON.stringify(historico));
    atualizarDadosPartida(timeA,timeB,vencedor,false);
    document.getElementById("timeA").value="";
    document.getElementById("timeB").value="";
    document.getElementById("vencedor").value="A";
    document.getElementById("dataJogo").value="";
    preencherTabela();
});

function atualizarDadosPartida(timeA,timeB,vencedor,reverso=false){
    const ajusta = reverso? (v,d)=>[d,v] : (v,d)=>[v,d];
    timeA.forEach(j=>{
        let jogador = jogadores.find(x=>x.nome===j);
        if(!jogador) jogadores.push({nome:j,v:0,d:0});
        jogador = jogadores.find(x=>x.nome===j);
        if(vencedor==="A") [jogador.v,jogador.d]=ajusta(jogador.v+1,jogador.d);
        else [jogador.v,jogador.d]=ajusta(jogador.v,jogador.d+1);
    });
    timeB.forEach(j=>{
        let jogador = jogadores.find(x=>x.nome===j);
        if(!jogador) jogadores.push({nome:j,v:0,d:0});
        jogador = jogadores.find(x=>x.nome===j);
        if(vencedor==="B") [jogador.v,jogador.d]=ajusta(jogador.v+1,jogador.d);
        else [jogador.v,jogador.d]=ajusta(jogador.v,jogador.d+1);
    });
}

function atualizarHistorico(){
    const div = document.getElementById("listaHistorico");
    div.innerHTML="";
    historico.forEach((p,i)=>{
        const histDiv = document.createElement("div");
        histDiv.className="histItem";

        const dataFormatada = p.data.split("-").reverse().join("/");

        histDiv.innerHTML=`<span>Data: ${dataFormatada} - Time A [${p.timeA.join(", ")}] x Time B [${p.timeB.join(", ")}] - Vencedor: Time ${p.vencedor}</span>`;
        
        const btnEdit = document.createElement("button");
        btnEdit.textContent="‚úèÔ∏è";
        btnEdit.title="Editar lan√ßamento";
        btnEdit.onclick=()=>{
            document.getElementById("timeA").value=p.timeA.join("\n");
            document.getElementById("timeB").value=p.timeB.join("\n");
            document.getElementById("vencedor").value=p.vencedor;
            document.getElementById("dataJogo").value=p.data;
            historico.splice(i,1);
            atualizarDadosPartida(p.timeA,p.timeB,p.vencedor,true);
            localStorage.setItem("historicoPelada",JSON.stringify(historico));
            preencherTabela();
        }

        const btnDel = document.createElement("button");
        btnDel.textContent="üóë";
        btnDel.title="Apagar lan√ßamento";
        btnDel.onclick=()=>{
            [p.timeA,p.timeB].forEach(time=>{
                time.forEach(j=>{
                    const jogador = jogadores.find(x=>x.nome===j);
                    if(!jogador) return;
                    if(p.timeA.includes(j) && p.vencedor==="A" || p.timeB.includes(j) && p.vencedor==="B") jogador.v--;
                    else jogador.d--;
                    if(jogador.v===0 && jogador.d===0){
                        const apareceuAntes = historico.some(h=>{
                            return h!==p && (h.timeA.includes(j) || h.timeB.includes(j));
                        });
                        if(!apareceuAntes){
                            jogadores = jogadores.filter(x=>x.nome!==j);
                        }
                    }
                });
            });
            historico.splice(i,1);
            localStorage.setItem("historicoPelada", JSON.stringify(historico));
            localStorage.setItem("jogadoresPelada", JSON.stringify(jogadores));
            preencherTabela();
        }

        const btnContainer = document.createElement("span");
        btnContainer.style.marginLeft="10px";
        btnContainer.appendChild(btnEdit); // editar primeiro
        btnContainer.appendChild(btnDel);  // apagar depois
        histDiv.appendChild(btnContainer);

        div.appendChild(histDiv);
    });
}

function resetarRanking(){
    if(confirm("Deseja realmente resetar o ranking para os dados de 13/08/2025? Todos os lan√ßamentos ser√£o apagados.")){
        jogadores = dadosIniciais.slice();
        historico = [];
        localStorage.setItem("jogadoresPelada", JSON.stringify(jogadores));
        localStorage.setItem("historicoPelada", JSON.stringify(historico));
        preencherTabela();
    }
}

function atualizarUltimaData(){
    if(historico.length===0){
        document.getElementById("atualizadoEm").textContent = "Atualizado em: 13/08/2025";
        return;
    }
    const ultData = historico[historico.length-1].data.split("-").reverse().join("/");
    document.getElementById("atualizadoEm").textContent = `Atualizado em: ${ultData}`;
}

window.onload = ()=>preencherTabela('saldo');
</script>
</body>
</html>
